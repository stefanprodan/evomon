
ALERT exporter_down
  IF up == 0
  FOR 1m
  LABELS { severity = "critical" }
  ANNOTATIONS {
    SUMMARY= "Exporter alert",
    DESCRIPTION= "Exporter {{$labels.job}} on {{ $labels.instance }} has been down for more than 60 seconds.",
  }

ALERT kafka_memory_usage
  IF avg(container_memory_usage_bytes{container_label_com_docker_swarm_service_name=~"te-kafka_kafka.*"}) by (container_label_com_docker_swarm_service_name, instance) > 16000000000
  FOR 2m
  LABELS { severity = "warning" }
  ANNOTATIONS {
      SUMMARY= "Kafka memory alert",
      DESCRIPTION= "{{ $labels.container_label_com_docker_swarm_service_name }} on {{ $labels.instance }} memory consumption is at {{ humanize $value}}",
  }

ALERT zkp_memory_usage
  IF avg(container_memory_usage_bytes{container_label_com_docker_swarm_service_name=~"te-kafka_zookeeper.*"}) by (container_label_com_docker_swarm_service_name, instance) > 4000000000
  FOR 2m
  LABELS { severity = "warning" }
  ANNOTATIONS {
      SUMMARY= "Zookeeper memory alert",
      DESCRIPTION= "{{ $labels.container_label_com_docker_swarm_service_name }} on {{ $labels.instance }} memory consumption is at {{ humanize $value}}",
  }

ALERT server_memory_usage
  IF (((node_memory_MemTotal-node_memory_MemFree-node_memory_Cached)/(node_memory_MemTotal)*100)) > 1
  FOR 2m
  LABELS { severity = "critical" }
  ANNOTATIONS {
      SUMMARY= "Server memory alert",
      DESCRIPTION= "{{ $labels.instance }} memory consumption is at {{ $value }}%",
  }

ALERT server_load
  IF ((node_load5 / count without (cpu, mode) (node_cpu{mode="system"})) > 1)
  FOR 2m
  LABELS { severity = "warning" }
  ANNOTATIONS {
    SUMMARY= "Server load alert",
    DESCRIPTION= "{{ $labels.instance }} load5 is at {{ $value }}"
  }

ALERT server_cpu_usage
  IF (100 - (avg by (instance) (irate(node_cpu{mode="idle"}[5m])) * 100)) > 1
  FOR 2m
  LABELS { severity = "warning" }
  ANNOTATIONS {
    SUMMARY= "Server CPU alert",
    DESCRIPTION= "{{ $labels.instance }} CPU consumption is at {{ $value }}%"
  }

ALERT server_disk_usage
  IF ((node_filesystem_size{mountpoint="/"} - node_filesystem_free{mountpoint="/"} ) / node_filesystem_size{mountpoint="/"} * 100) > 1
  FOR 2m
  LABELS { severity = "critical" }
  ANNOTATIONS {
    SUMMARY = "Server disk alert",
    DESCRIPTION = "{{ $labels.instance }} disk consumption is at {{ $value }}%"
  }
